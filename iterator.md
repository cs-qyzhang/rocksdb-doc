---
title: "迭代器"
date: 2020-06-24
lastmod: 2020-06-24
authors: []
---

在 LevelDB 中，大量的使用了迭代器。迭代器的使用可以**隐藏底层数据结构的实现**，用户无需知道底层的实现就可以操纵数据结构。在 LevelDB 中的迭代器不仅可以操纵单个数据结构，还可以操纵数据库文件，并且可以使用一个迭代器来同时迭代具有层次关系的多个数据结构。

## 基类：`Iterator`

`Iterator` 是一个抽象类，定义了迭代器的接口，其他类对应的迭代器大都继承自 `Iterator` 类（即使没有继承自该类也提供了相同的接口）。

| 函数                | 说明                                         |
| ------------------- | -------------------------------------------- |
| `Valid()`           | 迭代器当前位置是否有效                       |
| `SeekToFirst()`     | 将迭代器移到第一个位置                       |
| `SeekToLast()`      | 将迭代器移到最后一个位置                     |
| `Seek(target)`      | 将迭代器移到 target 或其之后的位置           |
| `Next()`            | 移到下一个位置                               |
| `Prev()`            | 移到前一个位置                               |
| `key()`             | 返回当前位置对应键值对的 `key` 值            |
| `value()`           | 返回当前位置对应键值对的 `value` 值          |
| `RegisterCleanup()` | 注册一个清理函数，会在迭代器的析构函数中调用 |

## 跳表 skiplist

LevelDB 中使用跳表来作为 Memtable 的数据结构。跳表是在链表的基础上提出的，在逻辑层面上就相当于一个链表。LevelDB 为跳表定义了对应的迭代器，实现了迭代器的 `Next()`，`Prev()`，`Seek()` 等操作。在有了跳表的迭代器之后，用户就可以在无需了解跳表的实现细节前提下对跳表进行访问，并且访问接口和其他相统一。

## Memtable

`Memtable` 类中主要的数据结构就是跳表，使用跳表来存储键值对信息。`Memtable` 类也定义了迭代器，该迭代器类就是对跳表迭代器的封装，在实现时直接调用了跳表迭代器的对应函数。

## 
